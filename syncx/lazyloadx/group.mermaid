flowchart TD
    A[开始] --> B{初次检查 key 是否存在}
    B -->|存在| C[返回值]
    B -->|不存在| D[并发控制]
    D --> E{再次检查 key 是否存在}
    E -->|存在| F[返回值]
    E -->|不存在| G{检查创建函数是否为 nil}
    G -->|是| H[返回错误]
    G -->|否| I[调用创建函数]
    I --> J{创建函数是否成功}
    J -->|失败| K[返回错误]
    J -->|成功| L[存储新值]
    L --> M[返回值]
    C --> N[结束]
    F --> N
    H --> N
    K --> N
    M --> N
